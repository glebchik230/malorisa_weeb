// profile.js

const formSection = document.getElementById('profile-form-section');
const viewSection = document.getElementById('profile-view-section');

const profileForm = document.getElementById('profile-form');
const avatarInput = document.getElementById('avatar');

const displayName = document.getElementById('display-name');
const displayPhone = document.getElementById('display-phone');
const displayTelegramId = document.getElementById('display-telegramId');
const avatarPreview = document.getElementById('avatar-preview');
const ratingDisplay = document.getElementById('employee-rating');

const editBtn = document.getElementById('edit-profile-btn');
const btnHome = document.getElementById('btn-home');

// Функция сохранения данных в localStorage
function saveProfile(data) {
  localStorage.setItem('profileData', JSON.stringify(data));
}

// Функция загрузки данных из localStorage
function loadProfile() {
  const data = localStorage.getItem('profileData');
  return data ? JSON.parse(data) : null;
}

// Отобразить данные профиля
function showProfile(data) {
  displayName.textContent = data.name;
  displayPhone.textContent = data.phone;
  displayTelegramId.textContent = data.telegramId;
  ratingDisplay.textContent = data.rating || '★★★☆☆';

  if (data.avatar) {
    avatarPreview.src = data.avatar;
  } else {
    avatarPreview.src = 'default-avatar.png'; // можно добавить свой дефолтный аватар
  }

  formSection.style.display = 'none';
  viewSection.style.display = 'block';
}

// Предзаполнить форму
function fillForm(data) {
  profileForm.name.value = data.name || '';
  profileForm.phone.value = data.phone || '';
  profileForm.telegramId.value = data.telegramId || '';
  // Аватарка — оставить как есть, загрузка новая по желанию
}

// Конвертация выбранной аватарки в base64 для localStorage
function readAvatarFile(file) {
  return new Promise((resolve, reject) => {
    if (!file) resolve(null);
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
    reader.readAsDataURL(file);
  });
}

// Обработка отправки формы
profileForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = profileForm.name.value.trim();
  const phone = profileForm.phone.value.trim();
  const telegramId = profileForm.telegramId.value.trim();
  const avatarFile = avatarInput.files[0];

  if (!name || !phone || !telegramId) {
    alert('Пожалуйста, заполните все обязательные поля!');
    return;
  }

  const avatarBase64 = await readAvatarFile(avatarFile);

  const profileData = {
    name,
    phone,
    telegramId,
    avatar: avatarBase64,
    rating: '★★★★☆' // пример рейтинга, можно потом динамически менять
  };

  saveProfile(profileData);
  showProfile(profileData);
});

// Обработка кнопки "Редактировать"
editBtn.addEventListener('click', () => {
  const data = loadProfile();
  if (data) {
    fillForm(data);
  }
  formSection.style.display = 'block';
  viewSection.style.display = 'none';
});

// Кнопка "На главный экран"
btnHome.addEventListener('click', () => {
  window.location.href = 'index.html';
});

// При загрузке страницы показать профиль или форму
window.addEventListener('DOMContentLoaded', () => {
  const data = loadProfile();
  if (data) {
    showProfile(data);
  } else {
    formSection.style.display = 'block';
    viewSection.style.display = 'none';
  }
});


